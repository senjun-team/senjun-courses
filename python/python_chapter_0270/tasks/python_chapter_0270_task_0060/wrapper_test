from io import StringIO
import sys


old_stdout = sys.stdout
sys.stdout = mystdout = StringIO()

#INJECT-b585472fa

sys.stdout = old_stdout
print_res = mystdout.getvalue()

if print_res != "f\nf\nf\nf\n":
    print('Console output is not correct')
    exit(1)

if 'run_in_loop' not in locals():
    print("There is no `run_in_loop` function")
    exit(1)

if 'f' not in locals():
    print("There is no `f` function")
    exit(1)

if not callable(run_in_loop):
    print("Variable 'run_in_loop' is not a function")
    exit(1)

if not callable(f):
    print("Variable 'f' is not a function")
    exit(1)

text = """
#INJECT-ESCAPED-b585472fa
"""

if text.find("@run_in_loop(4)") == -1:
    print("There is no function decorated with @run_in_loop(4)")
    exit(1)

if f.__doc__.strip() != "Test function":
    print("f() metadata is invalid:", f.__doc__)
    exit(1)

if f.__name__ != "f":
    print("f() metadata is invalid:", f.__name__)
    exit(1)